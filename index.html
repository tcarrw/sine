<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sine — Calm & Breath</title>
<meta name="description" content="Local tone generator for relaxation: breath pacer, single tone, optional binaural beat, and a gentle 3-phase calming sequence.">
<meta name="robots" content="index,follow,max-image-preview:large,max-video-preview:-1,max-snippet:-1">
<style>
  :root{
    --bg:#0B0F19;--ink:#E6EAF2;--muted:#A5B4CF;--line:rgba(255,255,255,.12);
    --card:#0F1524;--hi:#FFD6A8;--ok:#7EE7D9;--warn:#FBBF24;
    --accent:#F2A6B3;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial}
  header{padding:24px 20px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,rgba(255,214,168,.08),transparent)}
  h1{margin:0 0 6px;font-size:20px}
  p{margin:0;color:var(--muted)}
  main{max-width:860px;margin:0 auto;padding:20px;display:grid;gap:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="range"]{width:100%}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{appearance:none;border:1px solid var(--line);background:#151b2a;color:var(--ink);
    padding:10px 14px;border-radius:10px;cursor:pointer}
  button.primary{background:var(--accent);color:#111;border-color:transparent}
  button.ghost{background:transparent}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:12px}
  .kv{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .value{min-width:64px;text-align:right;color:var(--hi);font-variant-numeric:tabular-nums}
  .breath{display:flex;justify-content:center;align-items:center;height:220px;position:relative}
  .orb{width:60px;height:60px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ffe9d4, #d39ea8 60%, #7e79f0);
    filter:blur(0.2px);opacity:.9;transition:transform .6s ease, opacity .6s ease}
  .meter{height:6px;background:linear-gradient(90deg,var(--ok),var(--accent));border-radius:6px;transition:width .3s}
  .muted{color:var(--muted);font-size:13px}
  .grid{display:grid;gap:10px}
  .tiny{font-size:12px;color:var(--muted)}
  @media (max-width:720px){.row,.row-3{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <h1>Sine — Calm & Breath</h1>
  <p>Gentle tones for relaxation, focus, and breath pacing. Headphones recommended for binaural mode.</p>
</header>

<main>
  <!-- Breath Pacer -->
  <section class="card">
    <div class="kv"><strong>Breath Pacer</strong><span class="pill" id="pacerLabel">4 in / 6 out</span></div>
    <div class="breath"><div class="orb" id="orb"></div></div>
    <div class="row">
      <div>
        <label for="inh">Inhale seconds</label>
        <input id="inh" type="range" min="2" max="8" step="1" value="4">
      </div>
      <div>
        <label for="exh">Exhale seconds</label>
        <input id="exh" type="range" min="3" max="12" step="1" value="6">
      </div>
    </div>
    <div class="controls">
      <button id="pacerStart" class="primary">Start Pacer</button>
      <button id="pacerStop" class="ghost">Stop Pacer</button>
    </div>
  </section>

  <!-- Tone Generator -->
  <section class="card">
    <div class="kv"><strong>Single Tone</strong><span class="value" id="freqVal">136.1 Hz</span></div>
    <div class="row-3">
      <div>
        <label for="freq">Frequency (Hz)</label>
        <input id="freq" type="range" min="20" max="1000" step="0.1" value="136.1">
      </div>
      <div>
        <label for="gain">Volume</label>
        <input id="gain" type="range" min="0" max="1" step="0.001" value="0.25">
      </div>
      <div>
        <label for="shape">Wave</label>
        <select id="shape">
          <option>sine</option>
          <option>triangle</option>
          <option>sawtooth</option>
          <option>square</option>
        </select>
      </div>
    </div>
    <div class="controls">
      <button id="toneStart" class="primary">Start Tone</button>
      <button id="toneStop" class="ghost">Stop Tone</button>
    </div>
    <div class="tiny">Tip: 128–150 Hz can feel chest-centered; 220 Hz often feels “voice-like”.</div>
  </section>

  <!-- Binaural Beat -->
  <section class="card">
    <div class="kv"><strong>Binaural</strong><span class="pill" id="bnLabel">Base 220 Hz • Beat 8 Hz</span></div>
    <div class="row-3">
      <div>
        <label for="bnBase">Base (Hz)</label>
        <input id="bnBase" type="range" min="80" max="600" step="0.1" value="220">
      </div>
      <div>
        <label for="bnBeat">Beat (Hz)</label>
        <input id="bnBeat" type="range" min="1" max="12" step="0.1" value="8">
      </div>
      <div>
        <label for="bnGain">Volume</label>
        <input id="bnGain" type="range" min="0" max="1" step="0.001" value="0.18">
      </div>
    </div>
    <div class="controls">
      <button id="bnStart" class="primary">Start Binaural</button>
      <button id="bnStop" class="ghost">Stop Binaural</button>
    </div>
    <div class="tiny">Headphones only. Left plays base; right plays base+beat to create the perceived rhythm in your brain.</div>
  </section>

  <!-- 3-Phase Calming Sequence -->
  <section class="card">
    <div class="kv"><strong>Calming Sequence</strong><span class="pill" id="seqState">Idle</span></div>
    <div class="grid">
      <div class="meter" id="seqMeter" style="width:0%"></div>
      <div class="row-3">
        <div>
          <label for="t1">Phase 1 (Hz • sec)</label>
          <input id="t1" type="text" value="136.1 • 60">
        </div>
        <div>
          <label for="t2">Phase 2 (Hz • sec)</label>
          <input id="t2" type="text" value="220 • 60">
        </div>
        <div>
          <label for="t3">Phase 3 (Hz • sec)</label>
          <input id="t3" type="text" value="128 • 30">
        </div>
      </div>
    </div>
    <div class="controls">
      <button id="seqStart" class="primary">Start Sequence</button>
      <button id="seqStop" class="ghost">Stop Sequence</button>
    </div>
    <div class="muted tiny">Format: “frequency • seconds”. Adjust to taste. This sequence is for relaxation and focus only.</div>
  </section>

  <section class="card">
    <strong>Notes</strong>
    <p class="muted">Use moderate volume. If you feel dizzy, anxious, or uncomfortable, stop and rest in silence.</p>
  </section>
</main>

<script>
let ctx=null;

// Breath pacer
let pacerTimer=null, inhale=4, exhale=6, orb=document.getElementById('orb');
const inhEl=document.getElementById('inh'), exhEl=document.getElementById('exh'), pacerLabel=document.getElementById('pacerLabel');
function pacerLoop(){
  const total=(inhale+exhale)*1000;
  let t=0, phase='inhale';
  pacerTimer=setInterval(function(){
    t+=100;
    const ms=t%total;
    if(ms < inhale*1000){
      if(phase!=='inhale'){phase='inhale'}
      const p=ms/(inhale*1000);
      orb.style.transform='scale('+(1+ p*1.2)+')';
      orb.style.opacity=String(0.7+0.3*p);
    }else{
      if(phase!=='exhale'){phase='exhale'}
      const ems=ms - inhale*1000;
      const p=1 - (ems/(exhale*1000));
      orb.style.transform='scale('+(1+ p*1.2)+')';
      orb.style.opacity=String(0.7+0.3*p);
    }
  },100);
}
document.getElementById('pacerStart').onclick=function(){
  clearInterval(pacerTimer); pacerLoop();
};
document.getElementById('pacerStop').onclick=function(){
  clearInterval(pacerTimer); orb.style.transform='scale(1)'; orb.style.opacity='0.9';
};
inhEl.oninput=function(){ inhale=Number(inhEl.value); pacerLabel.textContent=inhale+' in / '+exhale+' out'; };
exhEl.oninput=function(){ exhale=Number(exhEl.value); pacerLabel.textContent=inhale+' in / '+exhale+' out'; };

// Audio helpers
function ac(){ if(!ctx){ ctx=new (window.AudioContext||window.webkitAudioContext)(); } return ctx; }
function makeGain(g){ const node=ac().createGain(); node.gain.value=g; node.connect(ac().destination); return node; }

// Single tone
let toneOsc=null, toneGain=null;
const freqEl=document.getElementById('freq'), gainEl=document.getElementById('gain'), shapeEl=document.getElementById('shape'), freqVal=document.getElementById('freqVal');
freqEl.oninput=function(){ freqVal.textContent=Number(freqEl.value).toFixed(1)+' Hz'; if(toneOsc){ toneOsc.frequency.setValueAtTime(Number(freqEl.value), ac().currentTime); } };
gainEl.oninput=function(){ if(toneGain){ toneGain.gain.setTargetAtTime(Number(gainEl.value), ac().currentTime, 0.02); } };
document.getElementById('toneStart').onclick=function(){
  if(toneOsc) return;
  toneGain=makeGain(Number(gainEl.value));
  toneOsc=ac().createOscillator();
  toneOsc.type=shapeEl.value;
  toneOsc.frequency.value=Number(freqEl.value);
  toneOsc.connect(toneGain);
  toneOsc.start();
};
document.getElementById('toneStop').onclick=function(){
  if(!toneOsc) return;
  toneOsc.stop(); toneOsc.disconnect(); toneGain.disconnect(); toneOsc=null; toneGain=null;
};
shapeEl.oninput=function(){ if(toneOsc){ toneOsc.type=shapeEl.value; } };

// Binaural
let bnLeftOsc=null, bnRightOsc=null, bnGain=null, bnMerger=null;
const bnBase=document.getElementById('bnBase'), bnBeat=document.getElementById('bnBeat'), bnGainEl=document.getElementById('bnGain'), bnLabel=document.getElementById('bnLabel');
function updateBnLabel(){ bnLabel.textContent='Base '+Number(bnBase.value).toFixed(1)+' Hz • Beat '+Number(bnBeat.value).toFixed(1)+' Hz'; }
bnBase.oninput=updateBnLabel; bnBeat.oninput=updateBnLabel;
bnGainEl.oninput=function(){ if(bnGain){ bnGain.gain.setTargetAtTime(Number(bnGainEl.value), ac().currentTime, 0.02); } };
document.getElementById('bnStart').onclick=function(){
  if(bnLeftOsc) return;
  const A=ac();
  bnGain=A.createGain(); bnGain.gain.value=Number(bnGainEl.value);
  bnMerger=A.createChannelMerger(2);
  bnMerger.connect(bnGain).connect(A.destination);
  bnLeftOsc=A.createOscillator(); bnLeftOsc.type='sine'; bnLeftOsc.frequency.value=Number(bnBase.value);
  bnRightOsc=A.createOscillator(); bnRightOsc.type='sine'; bnRightOsc.frequency.value=Number(bnBase.value)+Number(bnBeat.value);
  const left=A.createGain(), right=A.createGain();
  bnLeftOsc.connect(left); bnRightOsc.connect(right);
  left.connect(bnMerger,0,0); right.connect(bnMerger,0,1);
  bnLeftOsc.start(); bnRightOsc.start();
  updateBnLabel();
};
document.getElementById('bnStop').onclick=function(){
  if(!bnLeftOsc) return;
  bnLeftOsc.stop(); bnRightOsc.stop();
  bnLeftOsc.disconnect(); bnRightOsc.disconnect();
  bnGain.disconnect(); bnMerger.disconnect();
  bnLeftOsc=bnRightOsc=bnGain=bnMerger=null;
};

// Calming sequence
let seqOsc=null, seqGain=null, seqTimer=null, seqProgress=0, seqTotal=0;
const seqState=document.getElementById('seqState'), meter=document.getElementById('seqMeter');
function parsePhase(txt){
  const parts=txt.split('•').map(s=>s.trim());
  const f=Number(parts[0]); const s=Number(parts[1]); if(!isFinite(f)||!isFinite(s)) return null;
  return {freq:f, sec:s};
}
function stopSeq(){
  clearInterval(seqTimer);
  if(seqOsc){ seqOsc.stop(); seqOsc.disconnect(); seqGain.disconnect(); }
  seqOsc=seqGain=null; seqTimer=null; seqProgress=0; seqTotal=0;
  meter.style.width='0%'; seqState.textContent='Idle';
}
document.getElementById('seqStart').onclick=function(){
  stopSeq();
  const ph1=parsePhase(document.getElementById('t1').value);
  const ph2=parsePhase(document.getElementById('t2').value);
  const ph3=parsePhase(document.getElementById('t3').value);
  const phases=[ph1,ph2,ph3].filter(Boolean);
  if(!phases.length) return;
  const A=ac(); seqGain=makeGain(0.2); seqOsc=A.createOscillator(); seqOsc.type='sine';
  seqOsc.connect(seqGain); seqOsc.start();
  seqTotal=phases.reduce((a,p)=>a+p.sec,0);
  let idx=0, elapsed=0;
  function setPhase(p){ seqOsc.frequency.setValueAtTime(p.freq,A.currentTime); seqState.textContent='Phase '+(idx+1)+' • '+p.freq+' Hz'; }
  setPhase(phases[idx]);
  seqTimer=setInterval(function(){
    elapsed+=0.1; seqProgress=(elapsed/seqTotal)*100; meter.style.width=Math.min(100,seqProgress)+'%';
    const cut=phases.slice(0,idx+1).reduce((a,p)=>a+p.sec,0);
    if(elapsed>=cut && idx<phases.length-1){ idx++; setPhase(phases[idx]); }
    if(elapsed>=seqTotal){ stopSeq(); }
  },100);
};
document.getElementById('seqStop').onclick=stopSeq;

// Accessibility: resume audio on user gesture if suspended
document.addEventListener('click', function(){ if(ctx && ctx.state==='suspended'){ ctx.resume(); } }, {once:false});
</script>
</body>
</html>
